<%- include("_header")-%>

<div class="container mt-4 mb-4">
    <div class="page-header mb-3">
        <h1>Conte a História da Sua Adoção!</h1>
        <p class="lead">Compartilhe a experiência do seu pet adotado e inspire outras pessoas a darem um lar amoroso a um animalzinho.</p>
    </div>

    <div class="form-container card p-4">
        <form action="/adotado" enctype="multipart/form-data" method="post" id="form-adotado">

            <div class="mb-3">
                <label for="arquivo" class="form-label">Foto do Pet:*</label>
                <div class="mb-2">
                    <img id="frame" src="" width="300px" height="200px" alt="Pré-visualização da foto do pet" class="img-preview border rounded" style="display: none; object-fit: cover;"/>
                </div>
                <input type="file" name="arquivo" id="arquivo" class="form-control" onchange="previewImage(event)" accept="image/*" required/>
                <button type="button" class="btn btn-sm btn-outline-secondary mt-2" onclick="clearImagePreview()">Limpar Imagem</button>
            </div>

            <div class="mb-3">
                <label for="nome_pet" class="form-label">Nome do Pet:*</label>
                <input type="text" placeholder="Nome do Pet" name="nome_pet" id="nome_pet" class="form-control" required/>
            </div>

            <div class="mb-3">
                <label for="nome_tutor" class="form-label">Nome do Tutor:*</label>
                <input type="text" placeholder="Seu nome" name="nome_tutor" id="nome_tutor" class="form-control" required/>
            </div>

            <div class="mb-3">
                <label for="historia" class="form-label">História da Adoção:*</label>
                <textarea name="historia" id="historia" rows="5" placeholder="Conte como foi a adoção, os momentos especiais..." class="form-control" required></textarea>
            </div>

            <div class="d-flex justify-content-between align-items-center">
                <a href="./adocao" class="btn btn-secondary">Cancelar</a>
                <input type="submit" value="Enviar História" class="btn btn-primary"/>
            </div>
            <small class="form-text text-muted mt-2">(*) Campos obrigatórios</small>

        </form>
    </div>
</div>

<script>
    const frame = document.getElementById('frame');
    const fileInput = document.getElementById('arquivo');

    function previewImage(event) {
        if (event.target.files && event.target.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                frame.src = e.target.result;
                frame.style.display = 'block';
                frame.alt = `Pré-visualização de ${event.target.files[0].name}`;
            }
            reader.readAsDataURL(event.target.files[0]);
        } else {
            clearImagePreview();
        }
    }

    function clearImagePreview() {
        frame.src = '';
        frame.style.display = 'none';
        frame.alt = 'Pré-visualização da foto do pet';
        if (fileInput) {
            fileInput.value = null;
        }
    }

    window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
            const form = document.getElementById('form-adotado');
            if (form) {
                form.reset();
            }
            clearImagePreview();
        }
    });

    clearImagePreview();

</script>

<%- include("_footer")-%>